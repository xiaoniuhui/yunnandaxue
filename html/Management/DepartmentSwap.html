<!--
	作者：369126371@qq.com
	时间：2016-10-26
	描述：部门调剂
-->
<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>部门调剂</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../../css/mui.min.css">
	</head>
<style>
	.mui-content{
		background:#fff;
		overflow: auto;
	}
	.headcount{
			background-color: rgb(44,195,255);
		}
	.mui-table-view-cell:after {
		position: absolute;
		right: 0;
		bottom: 0;
		left: 0px;
		height: 1px;
		content: '';
		-webkit-transform: scaleY(.5);
		transform: scaleY(.5);
		background-color: #DCDCDC;				
	}
	.mui-table-view-cell{
		color: #676767;
		font-size: 14px;
	}
	.lititle{
		width: 100%;
		font-size: 14px;
	}
	.lidivone{
		width: 30%;
		text-align: right;
		float: left;
	}
	.lidivtwo{
		width: 70%;
		float: left;
	}
	.lidivtwo input{
		font-size: 14px;
	}
	
	.buttondiv{
		width: 100%;
		height: 50px;
	}
	.buttonwebs{
		width: 98%;
		margin-left: 1%;
		height: 45px;
		background-color: rgb(44,195,255);
		color: #FFFFFF;
		font-size: 18px;
		letter-spacing: 5px;
		border: 1px solid rgb(90,200,255);
	}
	
	.inputluru{
		width: 90%;
		border: 1px #CCCCCC solid;
	}
   .hidediv{
		display: none;
	}
	#thelistul{
		padding: 5px;
	}
	input[type=text]{
		margin-bottom: 0px;
		height: 25px;
		line-height: 20px;
	}
	.flstdcode,.flrecid{
		display: none;
	}
	.fltitle{
		height: 50px;
		margin-top:5px ;
		width: 100%;
		text-align: center;
		font-size: 16px;
		letter-spacing: 5px;
		color: #FFFFFF;
		background-color: rgb(44,195,255);.
		line-height: 50px;
		padding-top: 12px;
	}
	.lbtitle{
		height: 30px;
		margin-top:5px ;
		width: 100%;
		text-align: center;
		font-size: 14px;
		letter-spacing: 5px;
		color: #FFFFFF;
		background-color: rgb(44,195,255);.
		line-height: 50px;
		padding-top: 5px;
	}
	.redbixu{
		color: red;
	}
	.plusandjian{
		float: left;
		height: 16px;
		width: 16px;
		border-radius: 8px;
		font-weight: 700;
		color: #FFFFFF;
		background-color: #666666;
		text-align: center;
		line-height: 16px;
		margin-right: 10px;
	}
		</style>
	</head>
	<body>


		<header class="mui-bar mui-bar-nav headcount">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: white;">
				<span style="font-size: 15px;"></span>
				
			</a>
			<h1 class="mui-title" style="color: #FFFFFF;">部门调剂申请单</h1>
		</header>
		<div class="mui-content">
    	 
			
				<div class="mui-content-padded" style="margin: 5px;">
			<ul class="mui-table-view" id="thelistul">
				<li class="mui-table-view-cell" style="display: none;" >
					<div class="lititle">
						<div class="lidivone">申报单位：</div>
						<div class="lidivtwo"><input class="inputluru" type="text"  id="Outorg" readonly="readonly"/></div>
					</div>
				</li>
				<li class="mui-table-view-cell" style="display: none;" >
					<div class="lititle">
						<div class="lidivone">调剂单编号：</div>
						<div class="lidivtwo"><input class="inputluru"  id="unitid"  type="text" /></div>
					</div>
				</li> 
				<li class="mui-table-view-cell">
					<div class="lititle">
						<div class="lidivone">变动日期<span class="redbixu">*</span>：</div>
						<div class="lidivtwo"><input class="inputluru qdht" id="jizrq"  readonly="readonly"  type="text" /></div>
					</div>
				</li>
				<li class="mui-table-view-cell">
					<div class="lititle">
						<div class="lidivone">新使用人<span class="redbixu">*</span>：</div>
						<div class="lidivtwo"><input class="inputluru qdht" id="lianxjbr" type="text"  /></div>
					</div>
					
				</li>
				<li class="mui-table-view-cell">
					<div class="lititle">
						<div class="lidivone ">新使用部门<span class="redbixu">*</span>：</div>
						<div class="lidivtwo"><input class="inputluru qdht" id="lianxjbrdh" type="text" /></div>
					</div>
					
				</li>
				

				<li class="mui-table-view-cell">
					<div class="lititle">
						<div class="lidivone">新存放地点<span class="redbixu">*</span>：</div>
						<div class="lidivtwo"><input class="inputluru qdht" type="text" id="biz_bj026_zicfl" /></div>
					</div>
					
				</li>
				
			
				<li class="mui-table-view-cell">
					<div class="lititle">
						<div class="lidivone">变动原因：</div>
						<div class="lidivtwo">
							<textarea id="Beiz" class="qdht" rows="2" cols="3"></textarea>
						</div>
					</div>
					
				</li>
				
					
				<li class="mui-table-view-cell" id="clickCard">
					<span style="font-size: 16px; font-weight: 700;">待调剂明细表：</span>
				</li>
				<div class="mui-card" style="margin:5px" id="assetcards'+i+'">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell mui-collapse"><a class="mui-navigate-right" href="#">
						BH20166505&nbsp;&nbsp;名称一</a>
						<div class="mui-collapse-content">
							<div class="lititle">
								<div class="sumdiv" id="zhanshidivshow">
									<ul class="mui-table-view">
										<li class="mui-table-view-cell zicbh">
										<div class="lititle">
											<div class="lidivone">
												资产编号：
											</div>
											<div class="lidivtwo">
												BH20166505
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell zicmc">
										<div class="lititle">
											<div class="lidivone">
												资产名称：
											</div>
											<div class="lidivtwo">
												名称一
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell classgbmc">
										<div class="lititle">
											<div class="lidivone">
												资产大类：
											</div>
											<div class="lidivtwo">
												大类一
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell zicflbt">
										<div class="lititle">
											<div class="lidivone">
												资产分类：
											</div>
											<div class="lidivtwo">
												分类一
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell pinp">
										<div class="lititle">
											<div class="lidivone">
												资产品牌：
											</div>
											<div class="lidivtwo">
												戴尔
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell guigxh">
										<div class="lititle">
											<div class="lidivone">
												规格型号：
											</div>
											<div class="lidivtwo">
												GHX50000
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell jiaz">
										<div class="lititle">
											<div class="lidivone">
												价值：
											</div>
											<div class="lidivtwo">
												100.00
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell">
										<div class="lititle">
											<div class="lidivone">
												处置形式：
											</div>
											<div class="lidivthere lanse assetcards'+i+' disposmodeclick">
												&nbsp;
											</div>
											<div class="hidediv">
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell shul">
										<div class="lititle">
											<div class="lidivone">
												数量：
											</div>
											<div class="lidivtwo">
												5
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell dateriqi">
										<div class="lititle">
											<div class="lidivone">
												取得日期：
											</div>
											<div class="lidivtwo">
												2016-10-26
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell ziclbmc">
										<div class="lititle">
											<div class="lidivone">
												资产类别：
											</div>
											<div class="lidivtwo">
												类别一
											</div>
										</div>
										</li>
									</ul>
								</div>
							</div>
						</div>
						</li>
					</ul>
				</div>
				<div class="mui-card" style="margin:5px" id="assetcards'+i+'">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell mui-collapse"><a class="mui-navigate-right" href="#">
						BH20166507&nbsp;&nbsp;名称二</a>
						<div class="mui-collapse-content">
							<div class="lititle">
								<div class="sumdiv" id="zhanshidivshow">
									<ul class="mui-table-view">
										<li class="mui-table-view-cell zicbh">
										<div class="lititle">
											<div class="lidivone">
												资产编号：
											</div>
											<div class="lidivtwo">
												BH20166505
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell zicmc">
										<div class="lititle">
											<div class="lidivone">
												资产名称：
											</div>
											<div class="lidivtwo">
												名称一
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell classgbmc">
										<div class="lititle">
											<div class="lidivone">
												资产大类：
											</div>
											<div class="lidivtwo">
												大类一
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell zicflbt">
										<div class="lititle">
											<div class="lidivone">
												资产分类：
											</div>
											<div class="lidivtwo">
												分类一
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell pinp">
										<div class="lititle">
											<div class="lidivone">
												资产品牌：
											</div>
											<div class="lidivtwo">
												戴尔
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell guigxh">
										<div class="lititle">
											<div class="lidivone">
												规格型号：
											</div>
											<div class="lidivtwo">
												GHX50000
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell jiaz">
										<div class="lititle">
											<div class="lidivone">
												价值：
											</div>
											<div class="lidivtwo">
												100.00
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell">
										<div class="lititle">
											<div class="lidivone">
												处置形式：
											</div>
											<div class="lidivthere lanse assetcards'+i+' disposmodeclick">
												&nbsp;
											</div>
											<div class="hidediv">
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell shul">
										<div class="lititle">
											<div class="lidivone">
												数量：
											</div>
											<div class="lidivtwo">
												5
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell dateriqi">
										<div class="lititle">
											<div class="lidivone">
												取得日期：
											</div>
											<div class="lidivtwo">
												2016-10-26
											</div>
										</div>
										</li>
										<li class="mui-table-view-cell ziclbmc">
										<div class="lititle">
											<div class="lidivone">
												资产类别：
											</div>
											<div class="lidivtwo">
												类别一
											</div>
										</div>
										</li>
									</ul>
								</div>
							</div>
						</div>
						</li>
					</ul>
				</div>
			</ul>
			
		
			<div class="buttondiv">
				<button class="buttonwebs" id="comtodnaButton">提交</button>
			</div>
			</div>
		
		
		</div>
		
		
		<script src="../../js/jquery-1.11.3.js"></script>
		<script type="text/javascript" src="../../js/jqzw_server.js" ></script>
		<script type="text/javascript" src="../../js/mui.min.js" ></script>
		<script type="text/javascript" src="../../js/laydate/laydate.js" ></script>
		<script type="text/javascript" src="../../js/layer/layer.js" ></script>
		
		<script>
		var AssetCards = null;
		var AssetModCards= null;
		var Asindex;
		mui.init({
			beforeback: function(){
				//获得列表界面的webview
				var ScanCreateDan = plus.webview.getWebviewById('ScanCreateDan');
				//触发列表界面的自定义事件（refresh）,从而进行数据刷新
				mui.fire(ScanCreateDan,'refresh');
				//返回true，继续页面关闭逻辑
				return true;
			}
		})
		mui.plusReady(function(){
				
		});
		
		$(function(){
			
			var dd = new Date();
			var y = dd.getFullYear();
			var m = dd.getMonth()+1;//获取当前月份的日期
			if(m<10){
				m="0"+m.toString()
			}
			var d = dd.getDate(); 
			if(d<10){
				d="0"+d.toString()
			}
			$("#jizrq").val(y+"-"+m+"-"+d);
			
			//默认赋值
			/*$(".qdht").each(function(index){
				if(index == 0){ 
					return true;
				}
				$(this).val(1);
			})*/
			
			$("#zicfl").click(function(){
				$jqzw_server.callServer('ChaoYangMobile','getZiCFl').success(function(iv){
						createZicfl(iv);
					}).error(function(iv){
						console.log(iv);
					}).unlogin(function(iv){
						mui.toast("会话过久，可重新进行上次操作");
				});
				
			})
			
			$(document).on("click",".fltitle",function(){
				$("#zicfl").val($(this).text());
				$("#biz_bj026_zicfl").val($(this).siblings(".flrecid").text());
				layer.closeAll();
			})
			
			$(document).on("click",".disposmodeclick",function(){
				var disposmode = $(this).attr("class");
				var ints = parseInt(disposmode.replace(/[^0-9]/ig,""));
				Asindex = ints;
				$jqzw_server.callServer('ChaoYangMobile','getDisposMode').success(function(iv){
						createZicDm(iv);
					}).error(function(iv){
						console.log(iv);
					}).unlogin(function(iv){
						mui.toast("会话过久，可重新进行上次操作");
				});
			});
			
			$(document).on("click",".lbtitle",function(){
				var ConText = $(this).text();
				var ConRecid = $(this).siblings(".flrecid").text()
				$(".disposmodeclick").each(function(){
					
						if($(this).hasClass("assetcards"+Asindex)){
							$(this).text(ConText);
							$(this).siblings(".hidediv").text(ConRecid);
							
						}
				});
				AssetModCards[Asindex].chuzxsid = ConRecid;
				
				layer.closeAll();
			})
			
			$("#comtodnaButton").click(function(){
				var togo = true;
				var AssetDisposal ={};
				$(".qdht").each(function(){
					if($(this).val() == ""){
						var tiptext = $(this).parent().siblings(".lidivone").text();
						mui.toast(tiptext+"不能为空！");
						togo = false;
						return false;
					}
					var shuxing = $(this).attr("id");
					AssetDisposal[shuxing] = $(this).val();
				});
				//如果循环有未填写的表头将会直接返回 并给出提示
				if(!togo){
					return;
				}

				for(var i=0;i<AssetModCards.length;i++){
					
					if(AssetModCards[i].chuzxsid == null || AssetModCards[i].chuzxsid == ""){
						mui.toast("第"+(i+1)+"个未选择处置形式！");
						togo = false;
						break;
					
					}
					for(j in AssetModCards[i]){
						if(j != "chuzxsid" && j != "ziclbid"){						
							delete AssetModCards[i][j];
						}
					}
					
				}
				//如果循环有未填写标题的处置形式将会直接返回 并给出提示
				if(!togo){
					return;
				}
				
				var Assetsjson = "{"+"'AssetDisposal':'"+JSON.stringify(AssetDisposal)+"','AssetCards':'"+JSON.stringify(AssetCards)+"','AssetModCards':'"+JSON.stringify(AssetModCards)+"'}";
				
				$jqzw_server.callServer('ChaoYangMobile','createDiposeBillbyScanCode',Assetsjson).success(function(iv){
					console.log(iv)
						if(iv){
							mui.toast("保存成功！");
							mui.back();
						}else{
							mui.toast("保存失败！")
						}
					}).error(function(iv){
						mui.toast("保存失败！")
						console.log(iv);
					}).unlogin(function(iv){
						mui.toast("登录超时，可重新点击上一次按钮");
				});
			});
			
			
			$("#clickCard").click(function(){
				//createDivtoShow();
			});
			
			$(document).on("click",".mui-navigate-right",function(){
				console.log(1);
			});
			$(document).on("click",".checkboxitem",function(){
				if($(this).is(":checked")){
					$("."+$(this).attr("toclass")).show();
				}else{
					$("."+$(this).attr("toclass")).hide();
				}
			});
		});
		
		;!function(){

			laydate.skin('yalan');
			
			laydate({
			   elem: '#jizrq',
			   isclear: false, //是否显示清空
			   issure: false //是否显示确定
			})
		
		}();
		function createDivtoShow(){
			var opencheckhtmls = '<div id="checkboxcontent">'+$("#checkitemDiv").html()+'</div>'
			layer.open({
			    content: opencheckhtmls,
			});
		}
		function setDivAssetCard(assetcards){
				var gudingzichan = 0;
				var wuxingzichan = 0;
				for(var i in assetcards){
					var dateriq = new Date(assetcards[i].qudrq);
					var y = dateriq.getFullYear();
					var m = dateriq.getMonth()+1;//获取当前月份的日期
					if(m<10){
						m="0"+m.toString()
					}
					var d = dateriq.getDate(); 
					if(d<10){
						d="0"+d.toString();
					}
					var dateriqi = y+"-"+m+"-"+d;
					if(assetcards[i].ziclbmc == "固定资产"){
						AssetModCards[i]["ziclbid"] = "390ED44FE00000C1713ADFF2DA96D7E1"
						gudingzichan = gudingzichan+parseInt(assetcards[i].jiaz);
					}else{
						AssetModCards[i]["ziclbid"] = "390ED44FE00000E1C9CF8DC077BEC631"
						wuxingzichan = wuxingzichan+parseInt(assetcards[i].jiaz);
					}
					$("#thelistul").append('<div class="mui-card" style="margin:5px" id="assetcards'+i+'"><ul class="mui-table-view"><li class="mui-table-view-cell mui-collapse"><a class="mui-navigate-right" href="#"><div class="plusandjian">+</div>'+assetcards[i].zicbh+" "+assetcards[i].zicmc+'</a><div class="mui-collapse-content"><div class="lititle"><div class="sumdiv" id="zhanshidivshow"><ul class="mui-table-view"><li class="mui-table-view-cell zicbh"><div class="lititle"><div class="lidivone">资产编号：</div><div class="lidivtwo">'+assetcards[i].zicbh+'</div></div></li><li class="mui-table-view-cell zicmc"><div class="lititle"><div class="lidivone">资产名称：</div><div class="lidivtwo">'+assetcards[i].zicmc+'</div></div></li><li class="mui-table-view-cell classgbmc"><div class="lititle"><div class="lidivone">资产大类：</div><div class="lidivtwo">'+assetcards[i].classgbmc+'</div></div></li><li class="mui-table-view-cell zicflbt"><div class="lititle"><div class="lidivone">资产分类：</div><div class="lidivtwo">'+assetcards[i].zicflbt+'</div></div></li><li class="mui-table-view-cell pinp"><div class="lititle"><div class="lidivone">资产品牌：</div><div class="lidivtwo">'+assetcards[i].pinp+'</div></div></li><li class="mui-table-view-cell guigxh"><div class="lititle"><div class="lidivone">规格型号：</div><div class="lidivtwo">'+assetcards[i].guigxh+'</div></div></li><li class="mui-table-view-cell jiaz"><div class="lititle"><div class="lidivone">价值：</div><div class="lidivtwo">'+assetcards[i].jiaz+'</div></div></li><li class="mui-table-view-cell"><div class="lititle"><div class="lidivone">处置形式<span class="redbixu">*</span>：</div><div class="lidivthere lanse assetcards'+i+' disposmodeclick">&nbsp;</div><div class="hidediv"></div></div></li><li class="mui-table-view-cell shul"><div class="lititle"><div class="lidivone">数量：</div><div class="lidivtwo">'+assetcards[i].shul+'</div></div></li><li class="mui-table-view-cell dateriqi"><div class="lititle"><div class="lidivone">取得日期：</div><div class="lidivtwo">'+dateriqi+'</div></div></li><li class="mui-table-view-cell ziclbmc"><div class="lititle"><div class="lidivone">资产类别：</div><div class="lidivtwo">'+assetcards[i].ziclbmc+'</div></div></li></ul></div></div></div></li></ul></div>')
					
				}
				
				$("#gudzcyz").text(gudingzichan);
				$("#wuxzcyz").text(wuxingzichan);
				
			}

			function OutOrg(iv){
				$("#Outorg").val(iv.stdName);
				$("#unitid").val(iv.recid);
			}
			
			function createZicfl(iv){
				var contentDiv = "";
				for(i in iv){
					contentDiv = contentDiv+'<div><div><div class="fltitle">'+iv[i].stdname+'</div><div class="flrecid">'+iv[i].recid+'</div><div class="flstdcode">'+iv[i].stdcode+'</div></div></div>'
				}
				layer.open({
					    type: 1,
					    content: contentDiv,
					    anim: true,
					    style: 'position:fixed; bottom:0; left:0; width:100%; height:190px; padding:10px 0; border:none;'
				})
			}
			function createZicDm(iv){
				var contentDiv = "";
				for(i in iv){
					contentDiv = contentDiv+'<div><div><div class="lbtitle">'+iv[i].stdname+'</div><div class="flrecid">'+iv[i].recid+'</div><div class="flstdcode">'+iv[i].stdcode+'</div></div></div>'
				}
				layer.open({
					    type: 1,
					    content: contentDiv,
					    anim: true,
					    style: 'position:fixed; bottom:0; left:0; width:100%; height:205px; padding:10px 0; border:none;'
				}) 
			}
			
			
			
		</script>
	</body>

</html>