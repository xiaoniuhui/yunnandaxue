<!--
	作者：369126371@qq.com
	时间：2016-10-26
	描述：资产归回
-->
<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>资产归还</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../../css/mui.min.css">
	</head>
<style>
	.mui-content{
		background:#fff;
		overflow: auto;
	}
	.headcount{
			background-color: rgb(44,195,255);
		}
	.mui-table-view-cell:after {
		position: absolute;
		right: 0;
		bottom: 0;
		left: 0px;
		height: 1px;
		content: '';
		-webkit-transform: scaleY(.5);
		transform: scaleY(.5);
		background-color: #DCDCDC;				
	}
	.mui-table-view-cell{
		color: #676767;
		font-size: 14px;
	}
	.lititle{
		width: 100%;
		font-size: 14px;
	}
	.lidivone{
		width: 30%;
		text-align: right;
		float: left;
	}
	.lidivtwo{
		width: 70%;
		float: left;
	}
	.lidivtwo input{
		font-size: 14px;
	}
	
	.buttondiv{
		width: 100%;
		height: 50px;
	}
	.buttonwebs{
		width: 98%;
		margin-left: 1%;
		height: 45px;
		background-color: rgb(44,195,255);
		color: #FFFFFF;
		font-size: 18px;
		letter-spacing: 5px;
		border: 1px solid rgb(90,200,255);
	}
	
	.inputluru{
		width: 90%;
		border: 1px #CCCCCC solid;
	}
   .hidediv{
		display: none;
	}
	#thelistul{
		padding: 5px;
	}
	input[type=text]{
		margin-bottom: 0px;
		height: 25px;
		line-height: 20px;
	}
	.flstdcode,.flrecid{
		display: none;
	}
	.fltitle{
		height: 50px;
		margin-top:5px ;
		width: 100%;
		text-align: center;
		font-size: 16px;
		letter-spacing: 5px;
		color: #FFFFFF;
		background-color: rgb(44,195,255);.
		line-height: 50px;
		padding-top: 12px;
	}
	.lbtitle{
		height: 30px;
		margin-top:5px ;
		width: 100%;
		text-align: center;
		font-size: 14px;
		letter-spacing: 5px;
		color: #FFFFFF;
		background-color: rgb(44,195,255);.
		line-height: 50px;
		padding-top: 5px;
	}
	.redbixu{
		color: red;
	}
	.plusandjian{
		float: left;
		height: 16px;
		width: 16px;
		border-radius: 8px;
		font-weight: 700;
		color: #FFFFFF;
		background-color: #666666;
		text-align: center;
		line-height: 16px;
		margin-right: 10px;
	}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav headcount">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: white;">
				<span style="font-size: 15px;"></span>
			</a>
			<h1 class="mui-title" style="color: #FFFFFF;">资产归还</h1>
		</header>
		<div class="mui-content">
			<div class="mui-content-padded" style="margin: 5px;">
				<ul class="mui-table-view" id="thelistul">
					<li class="mui-table-view-cell" style="display: none;" >
						<div class="lititle">
							<div class="lidivone">申报单位：</div>
							<div class="lidivtwo"><input class="inputluru" type="text" id="Outorg" readonly="readonly"/></div>
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div class="lititle">
							<div class="lidivone">责任人：</div>
							<div class="lidivtwo" id="info-zrr"></div>
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div class="lititle">
							<div class="lidivone">接收人：</div>
							<div class="lidivtwo" id="info-jiesr"></div>
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div class="lititle">
							<div class="lidivone">经办人：</div>
							<div class="lidivtwo"><input class="inputluru qdht" type="text" id="BIZ_SDSFDX_JINGBR"/></div>
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div class="lititle">
							<div class="lidivone">归还时间：</div>
							<div class="lidivtwo"><input class="inputluru qdht" id="BIZ_SDSFDX_GUIHSJ" type="text" readonly="readonly" /></div>
						</div>
					</li>
					<li class="mui-table-view-cell">
						<div class="lititle">
							<div class="lidivone">设备附件：</div>
							<div class="lidivtwo"><input class="inputluru qdht" type="text" id="BIZ_SDSFDX_SHEBFJ"/></div>
						</div>
					</li>
					<li class="mui-table-view-cell" id="clickCard">
						<span style="font-size: 16px; font-weight: 700;">待归还资产信息：</span>
					</li>
				</ul>
				<div class="buttondiv">
					<button class="buttonwebs" id="comtodnaButton">确定</button>
				</div>
			</div>
		</div>
		
		
		<script src="../../js/jquery-1.11.3.js"></script>
		<script type="text/javascript" src="../../js/jqzw_server.js" ></script>
		<script type="text/javascript" src="../../js/mui.min.js" ></script>
		<script type="text/javascript" src="../../js/laydate/laydate.js" ></script>
		<script type="text/javascript" src="../../js/layer/layer.js" ></script>
		<script type="text/javascript" src="../../js/Util.js"></script>
		<script>
			var shiyrId = null;
			mui.init();
			mui.plusReady(function(){ 
				var AssetGuiHui = plus.webview.getWebviewById("AssetGuiHui");
				var assetcards = AssetGuiHui.assetcards;
				
				$("#BIZ_SDSFDX_GUIHSJ").val(getCurrentDateTime());
				$("#info-jiesr").text(localStorage.title);
				
				if(assetcards!==null && assetcards.length>=1) {
					shiyrId = assetcards[0].shiyrid;
					shiyrTitle = assetcards[0].shiyr;
					$('#info-zrr').text(shiyrTitle);
				}
				
				setDivAssetCard(assetcards);
			});
		
		$(function(){
			$("#comtodnaButton").click(function(){
				var AcceptBorrow = new Object();
				var flags = true;
				$(".qdht").each(function(){
					if($(this).val() == ""){
						var tiptext = $(this).parent().siblings(".lidivone").text();
						mui.toast(tiptext+"不能为空！");
						flags = false;
						return false;
					}
					var shuxing = $(this).attr("id");
					AcceptBorrow[shuxing] = $(this).val();
				});
				if(!flags){
					return false;
				}
				if(shiyrId!=null) {
					AcceptBorrow['BIZ_SDSFDX_ZERR'] = shiyrId;
				}
				//如果循环有未填写的表头将会直接返回 并给出提示

				var AssetGuiHuiobj = plus.webview.getWebviewById("AssetGuiHui");
				var assetcards = AssetGuiHuiobj.assetcards;
				
				var Assetsjson = "{"+"'AcceptGuiHui':'"+JSON.stringify(AcceptBorrow)+"','AssetCards':'"+JSON.stringify(assetcardsnew)+"'}";
//				console.log(Assetsjson);
				$jqzw_server.callServer('SdSfDxAssetReturnService','saveAssetReturn',Assetsjson).success(function(iv){
					console.log(iv)
					if(iv){
						mui.toast("保存成功！");
						mui.back();
					}else{
						mui.toast("保存失败！")
					}
				}).error(function(iv){
					mui.toast("保存失败！")
					console.log(iv);
				}).unlogin(function(iv){
					mui.toast("登录超时，可重新点击上一次按钮");
				});
			});
		});
		
		;!function(){
			laydate.skin('yalan');
			laydate({
			   elem: '#BIZ_SDSFDX_GUIHSJ',
			   format: 'YYYY-MM-DD hh:mm:ss',
			   istoday: true,
			   isclear: false, //是否显示清空
			   issure: true, //是否显示确定，
			   istime: true
			});
		}();
		var assetcardsnew = [];
		
		function setDivAssetCard(assetcards){
			console.log(JSON.stringify(assetcards));
			for(var i in assetcards){
				var objnew = new Object();
				objnew["recid"] = assetcards[i].recid;
				objnew["billdefine"] = assetcards[i].billdefine;
				objnew["objectid"] = assetcards[i].objectid;
				assetcardsnew.push(objnew);
				$("#thelistul").append('<div class="mui-card" style="margin:5px" id="assetcards'+i+'"><ul class="mui-table-view"><li class="mui-table-view-cell mui-collapse"><a class="mui-navigate-right" href="#"><div class="plusandjian">+</div>'+assetcards[i].zicbh+" "+assetcards[i].zicmc+'</a><div class="mui-collapse-content"><div class="lititle"><div class="sumdiv" id="zhanshidivshow"><ul class="mui-table-view"><li class="mui-table-view-cell zicbh"><div class="lititle"><div class="lidivone">资产编号：</div><div class="lidivtwo">'+assetcards[i].zicbh+'</div></div></li><li class="mui-table-view-cell zicmc"><div class="lititle"><div class="lidivone">资产名称：</div><div class="lidivtwo">'+assetcards[i].zicmc+'</div></div></li><li class="mui-table-view-cell guigxh"><div class="lititle"><div class="lidivone">规格型号：</div><div class="lidivtwo">'+assetcards[i].guigxh+'</div></div></li><li class="mui-table-view-cell guigxh"><div class="lititle"><div class="lidivone">项目经费1：</div><div class="lidivtwo">'+assetcards[i].xmjf1mc+'</div></div></li><li class="mui-table-view-cell jiaz"><div class="lititle"><div class="lidivone">价值：</div><div class="lidivtwo">'+assetcards[i].jiaz+'</div></div></li><li class="mui-table-view-cell shul"><div class="lititle"><div class="lidivone">责任人：</div><div class="lidivtwo">'+assetcards[i].shiyr+'</div></div></li></ul></div>')
			}
		}
		</script>
	</body>

</html>