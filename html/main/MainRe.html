<!--
	作者：369126371@qq.com
	时间：2016-11-22
	描述：功能配置页
-->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title></title>
		<link rel="stylesheet" href="../../css/font-awesome-4.5.0/css/font-awesome.min.css" />
		<link rel="stylesheet" href="../../css/mui.min.css" />
		<link rel="stylesheet" href="../../css/common.css" />
		<style>
			body{
				background-color: rgb(243,243,243);
			}
			.headcount{
				background-color: rgb(42,195,253);
			}
			.contdiv{
				float: left;
				width: 96%;
				margin-left: 2%;
				margin-top: 10px;
				font-size: 14px;
			}
			.titlediv{
				float: left;
				width:100%;	
			}
			.contsdiv{
				float: left;
				width: 100%;
				background-color: white;
				margin-top: 2px;
			}
			.crilediv{
				width: 12px;
				height: 12px;
				border-radius: 6px;
				background-color: #ACACB4;
				float: left;
				margin-top: 8px;
				margin-left: 10px;
			}
			.hlinediv{
				float: left;
				width: 100%;
				height: 30px;
				line-height: 30px;
			}
			.leftdiv{
				float: left;
				width: 8%;
				height: 30px;
				line-height: 30px;
			}
			.rightdiv{
				float: left;
				width: 82%;
				height: 30px;
				line-height: 30px;
			}
			.mui-grid-view.mui-grid-9 .mui-table-view-cell {
				margin: 0;
				padding: 5px 9px;
				vertical-align: top;
				border-right: 1px solid rgb(239,239,244);
				border-bottom: 1px solid rgb(239,239,244);
			}
			.leftdivone{
				float:left ;
				width: 50%;
				text-indent: 0.2em;
			}
			.rightdivone{
				float:left ;
				width: 50%;
				text-align: right;
			}
			.mui-media-body{
				font-size: 12px;
			}
			.tubiaodiv{
				font-size: 30px;
			}
			.blue{
				color: #0062CC;
			}
			.inputrow {
				border: solid 0px #CCCCCC;
				width: 95%;
				border-radius: 10px;
			}
			.inputrow input {
				width: 75%;
				margin-bottom: 0;
				padding-left: 0;
				border: 1px solid #CCCCCC; 
				border-top-left-radius:10px;
				border-bottom-left-radius:10px;
				border-top-right-radius:0px;
				border-bottom-right-radius:0px;
			}
			.inputrow label {
				font-family: 'Helvetica Neue',Helvetica,sans-serif;
				line-height: 1.1;
				float: right;
				width: 25%;
				padding: 10px 15px;
				height: 40px;
				border-top-right-radius:10px;
				border-bottom-right-radius:10px;
				border: 1px solid rgb(44,195,255); 
			}
			.tubiaodivs{
				position: absolute; 
				right: 0px;
			}
			.check{
				color: green;
			}
			.uncheck{
				color:red;
			}
			.hidediv{
				display: none;
			}
			.griddiv{
				font-size: 10px!important;
			}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav headcount">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color: white;">
				<span style="font-size: 15px;">返回</span>
			</a>
			<a id="bianjiqi" class=" mui-icon mui-pull-right" style="color: white;">		
				<span style="font-size: 15px;">编辑</span>
			</a>
			<h1 class="mui-title" style="color: #FFFFFF;">功能配置</h1>
		</header>
		<div class="mui-content divcontent">
			<div class="contdiv">
				<div class="titlediv">
					<div class="leftdivone">常用功能</div>
					<div class="rightdivone"></div>
				</div>
				<div class="contsdiv">
					<ul class="mui-table-view mui-grid-view mui-grid-9" id="xuanzhongdiv" style="background-color: #FFFFFF;"> 
			           
			         
						
			        </ul> 
				</div>
			</div>
			
			<div class="contdiv">
				<div class="titlediv">
					<div class="leftdivone">全部功能</div>
					<div class="rightdivone"></div>
				</div>
				<div class="contsdiv">
					<ul class="mui-table-view mui-grid-view mui-grid-9" style="background-color: #FFFFFF;" id="huangshiyu"> 
			           
			           
			          
			        </ul> 
				</div>
				
			</div>
			
		</div>
	</body>
	<script type="text/javascript" src="../../js/mui.min.js" ></script>
	<script type="text/javascript" src="../../js/jqzw_server.js" ></script>
	<script type="text/javascript" src="../../js/jquery-1.11.3.js" ></script>
	<script type="text/javascript" src="../../js/layer-v3.0.3/layer/layer.js" ></script>
	<script>
	mui.init({
		beforeback: function(){
			//触发列表界面的自定义事件（refresh）,从而进行数据刷新
			var uptoPage = plus.webview.getWebviewById("HomeList.html");
			mui.fire(uptoPage,'refreshgonggneng');
			//返回true，继续页面关闭逻辑
			return true;
		}
	})
		mui.plusReady(function(){ 
			$jqzw_server.callServer('SdSfDxInventoryClientService','initFunctionsList').success(function(iv){
				//console.log(JSON.stringify(iv))
				//console.log(JSON.stringify(iv)); 
				setDivIntohang(iv);
			}).error(function(iv){
				console.log(iv);
			}).unlogin(function(iv){
				mui.toast("会话过久，可重新进行上次操作"); 
			});
		});
		function setDivIntohang(lis){
			var html = "";
			var htmls = "";
			var unhtmls = "";
			for(var i in lis){
				if(lis[i].isenable){
					html = html + '<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">'
					+'<a class="shehuizuzhia" hrefto="ScanCredit.html" zbid="'+lis[i].wangyid+'" recid="'+lis[i].functionid+'" >'
					+' <i class="fa '+lis[i].picpath+' tubiaodiv " style="color:'+lis[i].piccolour+'" ></i>'
					+'<div class="mui-media-body griddiv">'+lis[i].gongnbt+'</div>'
					+'</a> </li>';
					htmls = htmls+ '<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">'
					+'<a class="shehuizuzhia shehuizuzhias" hrefto="ScanCredit.html" zbid="'+lis[i].wangyid+'" recid="'+lis[i].functionid+'"  >'
					+' <i class="fa fa-check-circle hidediv tubiaodivs check" ></i>'
					+' <i class="fa '+lis[i].picpath+' tubiaodiv " style="color:'+lis[i].piccolour+'" ></i>'
					+'<div class="mui-media-body griddiv">'+lis[i].gongnbt+'</div>'
					+'</a> </li>';
				}else{
					unhtmls = unhtmls+'<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">'
					+'<a class="shehuizuzhia shehuizuzhias" hrefto="ScanCredit.html" zbid="'+lis[i].wangyid+'" recid="'+lis[i].functionid+'"  >'
					+' <i class="fa fa-times-circle hidediv tubiaodivs uncheck" ></i>'
					+' <i class="fa '+lis[i].picpath+' tubiaodiv" style="color:'+lis[i].piccolour+'" ></i>'
					+'<div class="mui-media-body griddiv">'+lis[i].gongnbt+'</div>'
					+'</a> </li>';
				}
				
			}
			$("#xuanzhongdiv").html(html);
			$("#huangshiyu").html(htmls+unhtmls);
		}
		$(function(){ 
			$("#bianjiqi").click(function(){
				if($(this).hasClass("actives")){
					$(this).removeClass("actives");
					$(this).children("span").text("编辑");
					$(".check").addClass("hidediv");
					$(".uncheck").addClass("hidediv");
					var recids = [];
					$(".check").parent().each(function(){
						var recid =$(this).attr("recid");
						recids.push(recid);
					});
//					console.log(JSON.stringify(recids));
					if(recids.length == 0){
						layer.msg('最少选择一个功常用功能')
						return false;
					}
					$jqzw_server.callServer('SdSfDxInventoryClientService','savePersonFunctionList',JSON.stringify(recids)).success(function(iv){
						if(iv){
							  layer.msg('保存成功', {
							    time: 5000, //5s后自动关闭
							    shade:0.5,
							    shadeClose:true
							  });
						}else{
							layer.msg('保存失败', {
							    time: 5000, //5s后自动关闭
							    shade:0.5,
							    shadeClose:true
							  });
						}
//						console.log(iv)
						//console.log(JSON.stringify(iv)); 
						}).error(function(iv){
							console.log(iv);
						}).unlogin(function(iv){
							mui.toast("会话过久，可重新进行上次操作"); 
					});
				}else{
					$(this).children("span").text("保存");
					$("#huangshiyu .check").removeClass("hidediv");
					$("#huangshiyu .uncheck").removeClass("hidediv");
					$(this).addClass("actives")
				}
					
				
			})
			
			
			//mui自带监听事件
			mui("#huangshiyu").on('tap','.shehuizuzhias',function(){
				var $children = $(this).children(".tubiaodivs");
				$children.each(function(){
					if($(this).hasClass("uncheck")){
						if(!$(this).hasClass("hidediv")){
							$(this).addClass("hidediv");
							var html = $(this).parent("a").parent("li").prop("outerHTML");
							$("#xuanzhongdiv").prepend(html);
							$(this).removeClass("hidediv");
							$(this).addClass("check");
							$(this).removeClass("uncheck");
							$(this).addClass("fa-check-circle");
							$(this).removeClass("fa-times-circle");
						}
					}else{
						
						if(!$(this).hasClass("hidediv")){
							var zbid = $(this).parent("a").attr("zbid");
							$("#xuanzhongdiv").children("li").each(function(){
		
								if($(this).children("a").attr("zbid") == zbid){
									$(this).remove();
								}
							});
							$(this).addClass("uncheck");
							$(this).removeClass("check");
							$(this).addClass("fa-times-circle");
							$(this).removeClass("fa-check-circle");
						}
					}
				});
			});
		});
	</script>
</html>
